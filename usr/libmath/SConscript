# SPDX-License-Identifier: BSD-3-Clause
"""
libmath - Math library build configuration.
"""

from SCons.Script import Dir, Export

from scripts.scons.utility import GlobSources

Import('usermode_env')

env = usermode_env.Clone()

src_dir = Dir('#usr/libmath').abspath

# Shared library compilation flags
env.Append(
    CCFLAGS=['-fPIC'],
    CFLAGS=['-fPIC'],
    CXXFLAGS=['-fPIC'],
    LINKFLAGS=[
        '-shared',
        '-Wl,-soname,libmath.so',
    ],
    CPATH=[src_dir],
    CPPPATH=[src_dir],
    ASFLAGS=['-I', src_dir + '/', '-f', 'elf'],
)

sources = GlobSources(src_dir)
objects = env.SharedObject(sources)

libmath_library = env.SharedLibrary('math', objects)

libmath_module = libmath_library
Export('libmath_module')
